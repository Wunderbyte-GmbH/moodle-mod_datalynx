{"version":3,"file":"approve.min.js","sources":["../src/approve.js"],"sourcesContent":["export default {\n    init(approvedIcon, disapprovedIcon) {\n        // After initialization, loop through all elements for subscribe/unsubscribe.\n        document.querySelectorAll(\".datalynxfield__approve\").forEach(element => {\n            const href = element.href;\n            const params = extractParams(href.split('?')[1]);\n\n            // Add new click event listener\n            element.addEventListener('click', (e) => {\n                e.preventDefault(); // Don't follow hrefs.\n\n                // AJAX call\n                const actionUrl = \"field/_approve/ajax.php\";\n                fetch(actionUrl, {\n                    method: \"POST\",\n                    headers: {\n                        'Content-Type': 'application/x-www-form-urlencoded'\n                    },\n                    body: new URLSearchParams(params)\n                })\n                .then(response => {\n                    if (!response.ok) {\n                        throw new Error(`HTTP error! Status: ${response.status}`);\n                    }\n                    return response.json();\n                })\n                .then(data => {\n                    const imgElement = element.querySelector('img');\n                    if (data && imgElement.classList.contains('approved')) {\n                        imgElement.classList.remove('approved');\n                        imgElement.src = disapprovedIcon;\n                        imgElement.alt = 'approve';\n                        imgElement.title = 'approve';\n                        params.action = 'approve';\n                    } else if (data && !imgElement.classList.contains('approved')) {\n                        imgElement.classList.add('approved');\n                        imgElement.src = approvedIcon;\n                        imgElement.alt = 'disapprove';\n                        imgElement.title = 'disapprove';\n                        params.action = 'disapprove';\n                    }\n                    return null;\n                })\n                .catch((error) => {\n                    throw error;\n                });\n            });\n        });\n\n        // Extract params from a query string.\n        const extractParams = (paramString) => {\n            const params = new URLSearchParams(paramString);\n            const output = {};\n\n            for (const [key, value] of params.entries()) {\n                output[key] = value;\n            }\n\n            if ('approve' in output) {\n                output.entryid = output.approve;\n                output.action = 'approve';\n            } else if ('disapprove' in output) {\n                output.entryid = output.disapprove;\n                output.action = 'disapprove';\n            } else {\n                output.entryid = output.approve;\n                output.action = 'approve';\n            }\n\n            return output;\n        };\n    }\n};\n"],"names":["init","approvedIcon","disapprovedIcon","document","querySelectorAll","forEach","element","href","params","extractParams","split","addEventListener","e","preventDefault","fetch","method","headers","body","URLSearchParams","then","response","ok","Error","status","json","data","imgElement","querySelector","classList","contains","remove","src","alt","title","action","add","catch","error","paramString","output","key","value","entries","entryid","approve","disapprove"],"mappings":"2JAAe,CACXA,KAAKC,aAAcC,iBAEfC,SAASC,iBAAiB,2BAA2BC,SAAQC,gBACnDC,KAAOD,QAAQC,KACfC,OAASC,cAAcF,KAAKG,MAAM,KAAK,IAG7CJ,QAAQK,iBAAiB,SAAUC,IAC/BA,EAAEC,iBAIFC,MADkB,0BACD,CACbC,OAAQ,OACRC,QAAS,gBACW,qCAEpBC,KAAM,IAAIC,gBAAgBV,UAE7BW,MAAKC,eACGA,SAASC,SACJ,IAAIC,oCAA6BF,SAASG,gBAE7CH,SAASI,UAEnBL,MAAKM,aACIC,WAAapB,QAAQqB,cAAc,cACrCF,MAAQC,WAAWE,UAAUC,SAAS,aACtCH,WAAWE,UAAUE,OAAO,YAC5BJ,WAAWK,IAAM7B,gBACjBwB,WAAWM,IAAM,UACjBN,WAAWO,MAAQ,UACnBzB,OAAO0B,OAAS,WACTT,OAASC,WAAWE,UAAUC,SAAS,cAC9CH,WAAWE,UAAUO,IAAI,YACzBT,WAAWK,IAAM9B,aACjByB,WAAWM,IAAM,aACjBN,WAAWO,MAAQ,aACnBzB,OAAO0B,OAAS,cAEb,QAEVE,OAAOC,cACEA,qBAMZ5B,cAAiB6B,oBACb9B,OAAS,IAAIU,gBAAgBoB,aAC7BC,OAAS,OAEV,MAAOC,IAAKC,SAAUjC,OAAOkC,UAC9BH,OAAOC,KAAOC,YAGd,YAAaF,QACbA,OAAOI,QAAUJ,OAAOK,QACxBL,OAAOL,OAAS,WACT,eAAgBK,QACvBA,OAAOI,QAAUJ,OAAOM,WACxBN,OAAOL,OAAS,eAEhBK,OAAOI,QAAUJ,OAAOK,QACxBL,OAAOL,OAAS,WAGbK"}