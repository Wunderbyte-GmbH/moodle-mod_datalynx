{"version":3,"file":"fieldgroups.min.js","sources":["../src/fieldgroups.js"],"sourcesContent":["export default {\n    init(fieldgroupname, defaultlines, maxlines, requiredlines, fieldgroup) {\n        // Increment defaultlines to match the logic in original code\n        defaultlines++;\n\n        // Loop from defaultlines to maxlines to hide lines\n        for (let line = defaultlines; line <= maxlines; line++) {\n            document.querySelectorAll(`div[data-field-name='${fieldgroupname}'] [data-line='${line}']`).forEach(element => {\n                element.style.display = 'none'; // Hide the line\n            });\n        }\n\n        // Add button functionality to show hidden lines\n        document.querySelectorAll(\"div.datalynx-field-wrapper #id_addline\").forEach(button => {\n            button.addEventListener('click', (e) => {\n                e.preventDefault(); // Prevent default button behavior\n                const wrapper = button.closest(\".datalynx-field-wrapper\");\n                const firstHiddenLine = wrapper.querySelector(\"[data-line]:not([style*='display: none'])\");\n                if (firstHiddenLine) {\n                    firstHiddenLine.style.display = ''; // Show the first hidden line\n                }\n\n                // Increment lastvisible if less than maxlines\n                const lastVisibleInput = document.querySelector(`input[name='${fieldgroup}_lastvisible']`);\n                if (parseInt(lastVisibleInput.value, 10) < maxlines) {\n                    lastVisibleInput.value = parseInt(lastVisibleInput.value, 10) + 1;\n                }\n            });\n        });\n\n        // Remove line functionality\n        document.querySelectorAll(`div[data-field-name='${fieldgroupname}'] [data-removeline]`).forEach(removeButton => {\n            removeButton.removeEventListener('click', this.handleRemoveLine); // Remove any existing event listeners\n            removeButton.addEventListener('click', this.handleRemoveLine\n                .bind(this, removeButton, fieldgroupname, maxlines, requiredlines, fieldgroup)); // Attach new event listener\n        });\n    },\n\n    handleRemoveLine(removeButton, fieldgroupname, maxlines, requiredlines, fieldgroup, e) {\n        e.preventDefault(); // Prevent default link behavior\n\n        const thisLine = removeButton.closest('.lines');\n        const lineId = parseInt(thisLine.dataset.line, 10);\n        const parentContainer = thisLine.closest('.datalynx-field-wrapper');\n        const lastVisibleLine = Array.from(parentContainer\n            .querySelectorAll('.lines')).reverse().find(line => line.style.display !== 'none');\n        const lastVisibleLineId = parseInt(lastVisibleLine.dataset.line, 10);\n\n        // Remove all associated files\n        thisLine.querySelectorAll('.fp-file').forEach(file => {\n            file.click();\n            document.querySelector(\".fp-file-delete:visible\")?.click();\n            document.querySelector(\".fp-dlg-butconfirm:visible\")?.click();\n        });\n\n        // Clear input fields (except hidden)\n        thisLine.querySelectorAll('input').forEach(input => {\n            if (input.type !== 'hidden') {\n                input.value = '';\n            }\n        });\n\n        // Clear editor content\n        thisLine.querySelectorAll('.editor_atto_content').forEach(editor => {\n            editor.innerHTML = '';\n        });\n\n        // Clear textareas\n        thisLine.querySelectorAll('textarea').forEach(textarea => {\n            textarea.value = '';\n        });\n\n        // Clear select elements\n        thisLine.querySelectorAll('select').forEach(select => {\n            select.querySelector('option[value=\"\"]').selected = true;\n        });\n\n        // Deactivate time/date and remove tags\n        thisLine.querySelectorAll('[id$=enabled]:checked, .form-autocomplete-selection .tag').forEach(element => {\n            element.click();\n        });\n\n        // Update last visible line\n        const lastVisibleInput = document.querySelector(`input[name='${fieldgroup}_lastvisible']`);\n        lastVisibleInput.value = parseInt(lastVisibleInput.value, 10) - 1;\n\n        // Hide the line if not required\n        if (lineId > requiredlines && lineId >= 1) {\n            thisLine.style.display = 'none';\n\n            // Reorder lines\n            if (lineId !== maxlines) {\n                parentContainer.querySelectorAll('[data-line]').forEach(line => {\n                    const currentLineId = parseInt(line.dataset.line, 10);\n                    if (currentLineId > lineId && currentLineId <= lastVisibleLineId) {\n                        line.dataset.line = currentLineId - 1;\n                    } else if (currentLineId === lineId) {\n                        line.dataset.line = lastVisibleLineId;\n                    }\n                });\n            }\n\n            // Rebuild content order\n            const newContentOrder = [];\n            parentContainer.querySelectorAll('[data-line]').forEach(line => {\n                newContentOrder[line.dataset.line] = line;\n            });\n\n            parentContainer.innerHTML = ''; // Clear parent container\n            newContentOrder.reverse().forEach(line => {\n                if (line) {\n                    parentContainer.appendChild(line);\n                }\n            });\n        }\n    }\n};\n"],"names":["init","fieldgroupname","defaultlines","maxlines","requiredlines","fieldgroup","line","document","querySelectorAll","forEach","element","style","display","button","addEventListener","e","preventDefault","firstHiddenLine","closest","querySelector","lastVisibleInput","parseInt","value","removeButton","removeEventListener","this","handleRemoveLine","bind","thisLine","lineId","dataset","parentContainer","lastVisibleLine","Array","from","reverse","find","lastVisibleLineId","file","click","input","type","editor","innerHTML","textarea","select","selected","currentLineId","newContentOrder","appendChild"],"mappings":"+JAAe,CACXA,KAAKC,eAAgBC,aAAcC,SAAUC,cAAeC,gBAKnD,IAAIC,OAHTJ,aAG8BI,MAAQH,SAAUG,OAC5CC,SAASC,gDAAyCP,yCAAgCK,YAAUG,SAAQC,UAChGA,QAAQC,MAAMC,QAAU,UAKhCL,SAASC,iBAAiB,0CAA0CC,SAAQI,SACxEA,OAAOC,iBAAiB,SAAUC,IAC9BA,EAAEC,uBAEIC,gBADUJ,OAAOK,QAAQ,2BACCC,cAAc,6CAC1CF,kBACAA,gBAAgBN,MAAMC,QAAU,UAI9BQ,iBAAmBb,SAASY,oCAA6Bd,8BAC3DgB,SAASD,iBAAiBE,MAAO,IAAMnB,WACvCiB,iBAAiBE,MAAQD,SAASD,iBAAiBE,MAAO,IAAM,SAM5Ef,SAASC,gDAAyCP,wCAAsCQ,SAAQc,eAC5FA,aAAaC,oBAAoB,QAASC,KAAKC,kBAC/CH,aAAaT,iBAAiB,QAASW,KAAKC,iBACvCC,KAAKF,KAAMF,aAActB,eAAgBE,SAAUC,cAAeC,iBAI/EqB,iBAAiBH,aAActB,eAAgBE,SAAUC,cAAeC,WAAYU,GAChFA,EAAEC,uBAEIY,SAAWL,aAAaL,QAAQ,UAChCW,OAASR,SAASO,SAASE,QAAQxB,KAAM,IACzCyB,gBAAkBH,SAASV,QAAQ,2BACnCc,gBAAkBC,MAAMC,KAAKH,gBAC9BvB,iBAAiB,WAAW2B,UAAUC,MAAK9B,MAA+B,SAAvBA,KAAKK,MAAMC,UAC7DyB,kBAAoBhB,SAASW,gBAAgBF,QAAQxB,KAAM,IAGjEsB,SAASpB,iBAAiB,YAAYC,SAAQ6B,wDAC1CA,KAAKC,sCACLhC,SAASY,cAAc,mFAA4BoB,uCACnDhC,SAASY,cAAc,wFAA+BoB,WAI1DX,SAASpB,iBAAiB,SAASC,SAAQ+B,QACpB,WAAfA,MAAMC,OACND,MAAMlB,MAAQ,OAKtBM,SAASpB,iBAAiB,wBAAwBC,SAAQiC,SACtDA,OAAOC,UAAY,MAIvBf,SAASpB,iBAAiB,YAAYC,SAAQmC,WAC1CA,SAAStB,MAAQ,MAIrBM,SAASpB,iBAAiB,UAAUC,SAAQoC,SACxCA,OAAO1B,cAAc,oBAAoB2B,UAAW,KAIxDlB,SAASpB,iBAAiB,4DAA4DC,SAAQC,UAC1FA,QAAQ6B,iBAINnB,iBAAmBb,SAASY,oCAA6Bd,iCAC/De,iBAAiBE,MAAQD,SAASD,iBAAiBE,MAAO,IAAM,EAG5DO,OAASzB,eAAiByB,QAAU,EAAG,CACvCD,SAASjB,MAAMC,QAAU,OAGrBiB,SAAW1B,UACX4B,gBAAgBvB,iBAAiB,eAAeC,SAAQH,aAC9CyC,cAAgB1B,SAASf,KAAKwB,QAAQxB,KAAM,IAC9CyC,cAAgBlB,QAAUkB,eAAiBV,kBAC3C/B,KAAKwB,QAAQxB,KAAOyC,cAAgB,EAC7BA,gBAAkBlB,SACzBvB,KAAKwB,QAAQxB,KAAO+B,4BAM1BW,gBAAkB,GACxBjB,gBAAgBvB,iBAAiB,eAAeC,SAAQH,OACpD0C,gBAAgB1C,KAAKwB,QAAQxB,MAAQA,QAGzCyB,gBAAgBY,UAAY,GAC5BK,gBAAgBb,UAAU1B,SAAQH,OAC1BA,MACAyB,gBAAgBkB,YAAY3C"}