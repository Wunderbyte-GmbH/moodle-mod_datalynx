define(["jquery"],function(a){return{init:function(b,c,d,e){function f(b){var d=g(c.split("?")[1]),e=a(b).find("li");e.find("a").each(function(b,c){var e=g(a(c).prop("href").split("?")[1]);d.id==e.id&&a(c).parent().remove()}),0==b.children().length&&b.remove()}function g(a){for(var b=a.split("&"),c={},d=0;d<b.length;d++){var e=b[d];c[e.split("=")[0]]=e.split("=")[1]}return c}a("a.datalynxfield_subscribe").each(function(){var h=a(this).attr("href"),i=g(h.split("?")[1]);i.fieldid===b&&(i.ajax=!0,a("a.datalynxfield_subscribe").off("click"),a("a.datalynxfield_subscribe").click(function(b){b.preventDefault(),a(this).prev("ul").length||a(this).before("<ul></ul>");var g=a(this).prev("ul"),h="field/teammemberselect/ajax.php";a.ajax({method:"POST",url:h,data:i,context:this,dataType:"json",success:function(b){b&&a(this).hasClass("subscribed")?(e&&(a(this).toggleClass("subscribed"),a(this).prop("title","Eintragen"),a(this).prop("innerHTML","Eintragen"),i.action="subscribe",a(this).prop("href",a(this).prop("href").replace("unsubscribe","subscribe"))),f(g)):b&&!a(this).hasClass("subscribed")&&(a(this).toggleClass("subscribed"),a(this).prop("title","Austragen"),a(this).prop("innerHTML","Austragen"),i.action="unsubscribe",a(this).prop("href",a(this).prop("href").replace("subscribe","unsubscribe")),g.append("<li><a href="+c+">"+d+"</a></li>"))}})}))})}}});