{"version":3,"file":"teammemberselect.min.js","sources":["../src/teammemberselect.js"],"sourcesContent":["define([\"jquery\"], function($) {\n\n    return {\n        // We get parameters from initialisation in render.php\n        init: function(fieldid, userurl, username, canunsubscribe) {\n\n            // After initialisation we loop through all links for subscribe / unsubscribe.\n            $(\"a.datalynxfield_subscribe\").each(function() {\n                    var href = $(this).attr(\"href\");\n                    var params = extractParams(href.split(\"?\")[1]);\n                    if (params.fieldid !== fieldid) {\n                        return;\n                    }\n                    params.ajax = true;\n\n                    $(\"a.datalynxfield_subscribe\").off(\"click\");\n                    $(\"a.datalynxfield_subscribe\").click(function(e) {\n                        e.preventDefault();\n                        if (!$(this).prev(\"ul\").length) {\n                            $(this).before(\"<ul></ul>\");\n                        }\n                        var ul = $(this).prev(\"ul\");\n                        // AJAX call\n                        var actionurl = \"field/teammemberselect/ajax.php\";\n                        $.ajax(\n                            {\n                                method: \"POST\",\n                                url: actionurl,\n                                data: params,\n                                context: this,\n                                dataType: \"json\",\n                                success: function(data) {\n                                    if (data && $(this).hasClass(\"subscribed\")) {\n                                        if (canunsubscribe) {\n                                            $(this).toggleClass(\"subscribed\");\n                                            $(this).prop(\"title\", \"Eintragen\"); // TODO: Multilang.\n                                            $(this).prop(\"innerHTML\", \"Eintragen\"); // TODO: Multilang.\n                                            params.action = \"subscribe\";\n                                            $(this).prop(\"href\", $(this).prop(\"href\").replace(\"unsubscribe\", \"subscribe\"));\n                                        }\n                                    removeUser(ul);\n                                    } else if (data && !$(this).hasClass(\"subscribed\")) {\n                                        $(this).toggleClass(\"subscribed\");\n                                        $(this).prop(\"title\", \"Austragen\"); // TODO: Multilang.\n                                        $(this).prop(\"innerHTML\", \"Austragen\"); // TODO: Multilang.\n                                        params.action = \"unsubscribe\";\n                                        $(this).prop(\"href\", $(this).prop(\"href\").replace(\"subscribe\", \"unsubscribe\"));\n                                        ul.append(\"<li><a href=\" + userurl + \">\" + username + \"</a></li>\");\n                                    }\n                                },\n                            }\n                        );\n                });\n            });\n\n            /**\n             * Remove user from selection.\n             *\n             * @param {HTMLElement} listelement\n             */\n            function removeUser(listelement) {\n                var userurlparams = extractParams(userurl.split(\"?\")[1]);\n\n                // Loop through jquery object and find all lis.\n                var listItems = $(listelement).find(\"li\");\n                listItems.find(\"a\").each(function(idx, li) {\n                    var anchorparams = extractParams($(li).prop(\"href\").split(\"?\")[1]);\n                    if (userurlparams.id == anchorparams.id) {\n                        $(li).parent().remove();\n                    }\n                });\n                // Delete <ul> if no <li> is required.\n                if (listelement.children().length == 0) {\n                    listelement.remove();\n                }\n            }\n\n            /**\n             * Extract params.\n             * @param {string} paramstring\n             * @returns {{}}\n             */\n            function extractParams(paramstring) {\n                var params = paramstring.split(\"&\");\n                var output = {}; // Create an object.\n                for (var i = 0; i < params.length; i++) {\n                    var param = params[i];\n                    output[param.split(\"=\")[0]] = param.split(\"=\")[1];\n                }\n                return output;\n            }\n        }\n    };\n});\n"],"names":["define","$","init","fieldid","userurl","username","canunsubscribe","extractParams","paramstring","params","split","output","i","length","param","each","this","attr","ajax","off","click","e","preventDefault","prev","before","ul","method","url","data","context","dataType","success","listelement","userurlparams","hasClass","toggleClass","prop","action","replace","find","idx","li","anchorparams","id","parent","remove","children","append"],"mappings":"AAAAA,uCAAO,CAAC,WAAW,SAASC,SAEjB,CAEHC,KAAM,SAASC,QAASC,QAASC,SAAUC,yBA8E9BC,cAAcC,qBACfC,OAASD,YAAYE,MAAM,KAC3BC,OAAS,GACJC,EAAI,EAAGA,EAAIH,OAAOI,OAAQD,IAAK,KAChCE,MAAQL,OAAOG,GACnBD,OAAOG,MAAMJ,MAAM,KAAK,IAAMI,MAAMJ,MAAM,KAAK,UAE5CC,OAlFXV,EAAE,6BAA6Bc,MAAK,eAExBN,OAASF,cADFN,EAAEe,MAAMC,KAAK,QACQP,MAAM,KAAK,IACvCD,OAAON,UAAYA,UAGvBM,OAAOS,MAAO,EAEdjB,EAAE,6BAA6BkB,IAAI,SACnClB,EAAE,6BAA6BmB,OAAM,SAASC,GAC1CA,EAAEC,iBACGrB,EAAEe,MAAMO,KAAK,MAAMV,QACpBZ,EAAEe,MAAMQ,OAAO,iBAEfC,GAAKxB,EAAEe,MAAMO,KAAK,MAGtBtB,EAAEiB,KACE,CACIQ,OAAQ,OACRC,IAJQ,kCAKRC,KAAMnB,OACNoB,QAASb,KACTc,SAAU,OACVC,QAAS,SAASH,UA6BlBI,YACZC,cA7BoBL,MAAQ3B,EAAEe,MAAMkB,SAAS,eACrB5B,iBACAL,EAAEe,MAAMmB,YAAY,cACpBlC,EAAEe,MAAMoB,KAAK,QAAS,aACtBnC,EAAEe,MAAMoB,KAAK,YAAa,aAC1B3B,OAAO4B,OAAS,YAChBpC,EAAEe,MAAMoB,KAAK,OAAQnC,EAAEe,MAAMoB,KAAK,QAAQE,QAAQ,cAAe,eAsB7EN,YApBeP,GAqB3BQ,cAAgB1B,cAAcH,QAAQM,MAAM,KAAK,IAGrCT,EAAE+B,aAAaO,KAAK,MAC1BA,KAAK,KAAKxB,MAAK,SAASyB,IAAKC,QAC/BC,aAAenC,cAAcN,EAAEwC,IAAIL,KAAK,QAAQ1B,MAAM,KAAK,IAC3DuB,cAAcU,IAAMD,aAAaC,IACjC1C,EAAEwC,IAAIG,SAASC,YAIc,GAAjCb,YAAYc,WAAWjC,QACvBmB,YAAYa,UAhCejB,OAAS3B,EAAEe,MAAMkB,SAAS,gBACjCjC,EAAEe,MAAMmB,YAAY,cACpBlC,EAAEe,MAAMoB,KAAK,QAAS,aACtBnC,EAAEe,MAAMoB,KAAK,YAAa,aAC1B3B,OAAO4B,OAAS,cAChBpC,EAAEe,MAAMoB,KAAK,OAAQnC,EAAEe,MAAMoB,KAAK,QAAQE,QAAQ,YAAa,gBAC/Db,GAAGsB,OAAO,eAAiB3C,QAAU,IAAMC,SAAW"}