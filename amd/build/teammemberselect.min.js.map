{"version":3,"file":"teammemberselect.min.js","sources":["../src/teammemberselect.js"],"sourcesContent":["define(['core/ajax', 'core/toast', 'core/str'], function(Ajax, Toast, Str) {\n    return {\n        init(fieldid, userurl, username, canunsubscribe) {\n            Promise.all([\n                Str.get_string('subscribe', 'mod_datalynx'),\n                Str.get_string('unsubscribe', 'mod_datalynx')\n            ]).then(strings => {\n                const subscribeString = strings[0];\n                const unsubscribeString = strings[1];\n\n                document.querySelectorAll('a.datalynxfield_subscribe').forEach(link => {\n                    const params = this.extractParams(link.href.split('?')[1]);\n                    if (params.fieldid !== fieldid.toString()) {\n                        return;\n                    }\n\n                    link.addEventListener('click', (e) => {\n                        e.preventDefault();\n                        const updatedParams = this.extractParams(link.href.split('?')[1]);\n                        this.handleSubscription(link, updatedParams, userurl, username,\n                            canunsubscribe, subscribeString, unsubscribeString);\n                    });\n                });\n            });\n        },\n\n        handleSubscription(link, params, userurl, username, canunsubscribe, subscribeString, unsubscribeString) {\n            Ajax.call([{\n                methodname: 'mod_datalynx_team_subscription',\n                args: params,\n                done: (response) => {\n                    if (response.success) {\n                        if (link.classList.contains('subscribed')) {\n                            if (canunsubscribe) {\n                                this.updateSubscriptionLink(link, 'subscribe', subscribeString);\n                                this.removeUserFromList(link.parentElement, userurl);\n                            }\n                        } else {\n                            this.updateSubscriptionLink(link, 'unsubscribe', unsubscribeString);\n                            this.addUserToList(link.parentElement, userurl, username);\n                        }\n                    } else {\n                        Toast.add({ message: 'Error updating subscription', type: 'danger' });\n                    }\n                },\n                fail: () => {\n                    Toast.add({ message: 'Failed to process request.', type: 'danger' });\n                }\n            }]);\n        },\n\n        updateSubscriptionLink(link, action, text) {\n            link.classList.toggle('subscribed');\n            link.title = text;\n            link.textContent = text;\n            link.href = link.href.replace(/(subscribe|unsubscribe)/, action);\n        },\n\n        removeUserFromList(linkContainer, userurl) {\n            if (linkContainer) {\n                const teamMemberList = linkContainer.querySelector('.team-member-list');\n                if (teamMemberList) {\n                    const listItem = teamMemberList.querySelector(`li a[href=\"${userurl}\"]`);\n                    if (listItem) {\n                        listItem.closest('li').remove();\n                        if (teamMemberList.children.length === 0) {\n                            teamMemberList.remove();\n                        }\n                    }\n                }\n            }\n        },\n\n        addUserToList(linkContainer, userurl, username) {\n            let teamMemberList = linkContainer.querySelector('.team-member-list');\n            if (!teamMemberList) {\n                teamMemberList = document.createElement('ul');\n                teamMemberList.classList.add('team-member-list');\n                linkContainer.insertBefore(teamMemberList, linkContainer.querySelector(\"a.datalynxfield_subscribe\"));\n            }\n\n            const listItem = document.createElement('li');\n            listItem.innerHTML = `<a href=\"${userurl}\">${username}</a>`;\n            teamMemberList.appendChild(listItem);\n        },\n\n        extractParams(paramString) {\n            return paramString.split('&').reduce((acc, param) => {\n                const [key, value] = param.split('=');\n                acc[key] = decodeURIComponent(value || '');\n                return acc;\n            }, {});\n        }\n    };\n});"],"names":["define","Ajax","Toast","Str","init","fieldid","userurl","username","canunsubscribe","Promise","all","get_string","then","strings","subscribeString","unsubscribeString","document","querySelectorAll","forEach","link","this","extractParams","href","split","toString","addEventListener","e","preventDefault","updatedParams","handleSubscription","params","call","methodname","args","done","response","success","classList","contains","updateSubscriptionLink","removeUserFromList","parentElement","addUserToList","add","message","type","fail","action","text","toggle","title","textContent","replace","linkContainer","teamMemberList","querySelector","listItem","closest","remove","children","length","createElement","insertBefore","innerHTML","appendChild","paramString","reduce","acc","param","key","value","decodeURIComponent"],"mappings":"AAAAA,uCAAO,CAAC,YAAa,aAAc,aAAa,SAASC,KAAMC,MAAOC,WAC3D,CACHC,KAAKC,QAASC,QAASC,SAAUC,gBAC7BC,QAAQC,IAAI,CACRP,IAAIQ,WAAW,YAAa,gBAC5BR,IAAIQ,WAAW,cAAe,kBAC/BC,MAAKC,gBACEC,gBAAkBD,QAAQ,GAC1BE,kBAAoBF,QAAQ,GAElCG,SAASC,iBAAiB,6BAA6BC,SAAQC,OAC5CC,KAAKC,cAAcF,KAAKG,KAAKC,MAAM,KAAK,IAC5ClB,UAAYA,QAAQmB,YAI/BL,KAAKM,iBAAiB,SAAUC,IAC5BA,EAAEC,uBACIC,cAAgBR,KAAKC,cAAcF,KAAKG,KAAKC,MAAM,KAAK,SACzDM,mBAAmBV,KAAMS,cAAetB,QAASC,SAClDC,eAAgBM,gBAAiBC,6BAMrDc,mBAAmBV,KAAMW,OAAQxB,QAASC,SAAUC,eAAgBM,gBAAiBC,mBACjFd,KAAK8B,KAAK,CAAC,CACPC,WAAY,iCACZC,KAAMH,OACNI,KAAOC,WACCA,SAASC,QACLjB,KAAKkB,UAAUC,SAAS,cACpB9B,sBACK+B,uBAAuBpB,KAAM,YAAaL,sBAC1C0B,mBAAmBrB,KAAKsB,cAAenC,gBAG3CiC,uBAAuBpB,KAAM,cAAeJ,wBAC5C2B,cAAcvB,KAAKsB,cAAenC,QAASC,WAGpDL,MAAMyC,IAAI,CAAEC,QAAS,8BAA+BC,KAAM,YAGlEC,KAAM,KACF5C,MAAMyC,IAAI,CAAEC,QAAS,6BAA8BC,KAAM,gBAKrEN,uBAAuBpB,KAAM4B,OAAQC,MACjC7B,KAAKkB,UAAUY,OAAO,cACtB9B,KAAK+B,MAAQF,KACb7B,KAAKgC,YAAcH,KACnB7B,KAAKG,KAAOH,KAAKG,KAAK8B,QAAQ,0BAA2BL,SAG7DP,mBAAmBa,cAAe/C,YAC1B+C,cAAe,OACTC,eAAiBD,cAAcE,cAAc,wBAC/CD,eAAgB,OACVE,SAAWF,eAAeC,mCAA4BjD,eACxDkD,WACAA,SAASC,QAAQ,MAAMC,SACgB,IAAnCJ,eAAeK,SAASC,QACxBN,eAAeI,aAOnChB,cAAcW,cAAe/C,QAASC,cAC9B+C,eAAiBD,cAAcE,cAAc,qBAC5CD,iBACDA,eAAiBtC,SAAS6C,cAAc,MACxCP,eAAejB,UAAUM,IAAI,oBAC7BU,cAAcS,aAAaR,eAAgBD,cAAcE,cAAc,qCAGrEC,SAAWxC,SAAS6C,cAAc,MACxCL,SAASO,6BAAwBzD,qBAAYC,iBAC7C+C,eAAeU,YAAYR,WAG/BnC,cAAc4C,aACHA,YAAY1C,MAAM,KAAK2C,QAAO,CAACC,IAAKC,eAChCC,IAAKC,OAASF,MAAM7C,MAAM,YACjC4C,IAAIE,KAAOE,mBAAmBD,OAAS,IAChCH,MACR"}