{"version":3,"file":"datalynxloadviews.min.js","sources":["../src/datalynxloadviews.js"],"sourcesContent":["export default {\n    init(options) {\n        // Destructure the options object for easier access\n        const { dffield, viewfield, textfieldfield, acturl: actionurl, presentdlid, thisfieldstring, update, fieldtype } = options;\n\n        // Read courseid and call ajax at change to receive all groups in course.\n        const dffieldElement = document.getElementById(`id_${dffield}`);\n        const viewElement = document.getElementById(`id_${viewfield}`);\n        const textfieldElement = document.getElementById(`id_${textfieldfield}`);\n\n        if (dffieldElement) {\n            dffieldElement.addEventListener(\"change\", function() {\n                const dfid = this.value; // Get the datalynx id.\n\n                // Remove view and textfield options.\n                if (viewElement) {\n                    viewElement.innerHTML = ''; // Clear all current options.\n                }\n                if (textfieldElement) {\n                    textfieldElement.innerHTML = ''; // Clear all current options.\n                }\n\n                // Load views and/or textfields from datalynx if dfid is not zero.\n                if (dfid != 0) {\n                    // Fetch request to get current options.\n                    return fetch(actionurl, {\n                        method: \"POST\",\n                        headers: {\n                            'Content-Type': 'application/x-www-form-urlencoded',\n                        },\n                        body: `dfid=${dfid}`\n                    })\n                    .then(response => {\n                        if (!response.ok) {\n                            throw new Error('Network response was not ok');\n                        }\n                        return response.text(); // Ensure we return the result of this then\n                    })\n                    .then(data => {\n                        if (data !== '') {\n                            const respoptions = data.split('#');\n\n                            // Add view options.\n                            if (viewElement) {\n                                const viewoptions = respoptions[0].split(',');\n                                viewoptions.forEach(option => {\n                                    const [qid, ...qnameArr] = option.trim().split(' ');\n                                    const qname = qnameArr.join(' ');\n                                    const optionElement = document.createElement('option');\n                                    optionElement.value = qid;\n                                    optionElement.textContent = qname;\n                                    viewElement.appendChild(optionElement);\n                                });\n                            }\n\n                            // Add textfield options.\n                            if (textfieldElement) {\n                                const textfieldoptions = respoptions[1].split(',');\n\n                                // If this datalynx instance itself is chosen, provide this new field itself as first option.\n                                if (dfid == presentdlid && update === 0 && fieldtype === 'text') {\n                                    const optionElement = document.createElement('option');\n                                    optionElement.value = '-1';\n                                    optionElement.textContent = thisfieldstring;\n                                    textfieldElement.appendChild(optionElement);\n                                }\n\n                                textfieldoptions.forEach(option => {\n                                    const [qid, ...qnameArr] = option.trim().split(' ');\n                                    const qname = qnameArr.join(' ');\n                                    const optionElement = document.createElement('option');\n                                    optionElement.value = qid;\n                                    optionElement.textContent = qname;\n                                    textfieldElement.appendChild(optionElement);\n                                });\n                            }\n                        }\n                        return data; // Ensure we return the result of this then\n                    })\n                    .catch(() => {\n                        throw new Error(\"Error while loading views and textfields.\");\n                    });\n                } else {\n                    // If dfid is 0, we should return undefined explicitly to satisfy consistent-return.\n                    return undefined;\n                }\n            });\n        }\n    }\n};\n"],"names":["init","options","dffield","viewfield","textfieldfield","acturl","actionurl","presentdlid","thisfieldstring","update","fieldtype","dffieldElement","document","getElementById","viewElement","textfieldElement","addEventListener","dfid","this","value","innerHTML","fetch","method","headers","body","then","response","ok","Error","text","data","respoptions","split","forEach","option","qid","qnameArr","trim","qname","join","optionElement","createElement","textContent","appendChild","textfieldoptions","catch"],"mappings":"qKAAe,CACXA,KAAKC,eAEKC,QAAEA,QAAFC,UAAWA,UAAXC,eAAsBA,eAAgBC,OAAQC,UAA9CC,YAAyDA,YAAzDC,gBAAsEA,gBAAtEC,OAAuFA,OAAvFC,UAA+FA,WAAcT,QAG7GU,eAAiBC,SAASC,4BAAqBX,UAC/CY,YAAcF,SAASC,4BAAqBV,YAC5CY,iBAAmBH,SAASC,4BAAqBT,iBAEnDO,gBACAA,eAAeK,iBAAiB,UAAU,iBAChCC,KAAOC,KAAKC,aAGdL,cACAA,YAAYM,UAAY,IAExBL,mBACAA,iBAAiBK,UAAY,IAIrB,GAARH,KAEOI,MAAMf,UAAW,CACpBgB,OAAQ,OACRC,QAAS,gBACW,qCAEpBC,oBAAcP,QAEjBQ,MAAKC,eACGA,SAASC,SACJ,IAAIC,MAAM,sCAEbF,SAASG,UAEnBJ,MAAKK,UACW,KAATA,KAAa,OACPC,YAAcD,KAAKE,MAAM,QAG3BlB,YAAa,CACOiB,YAAY,GAAGC,MAAM,KAC7BC,SAAQC,eACTC,OAAQC,UAAYF,OAAOG,OAAOL,MAAM,KACzCM,MAAQF,SAASG,KAAK,KACtBC,cAAgB5B,SAAS6B,cAAc,UAC7CD,cAAcrB,MAAQgB,IACtBK,cAAcE,YAAcJ,MAC5BxB,YAAY6B,YAAYH,qBAK5BzB,iBAAkB,OACZ6B,iBAAmBb,YAAY,GAAGC,MAAM,QAG1Cf,MAAQV,aAA0B,IAAXE,QAA8B,SAAdC,UAAsB,OACvD8B,cAAgB5B,SAAS6B,cAAc,UAC7CD,cAAcrB,MAAQ,KACtBqB,cAAcE,YAAclC,gBAC5BO,iBAAiB4B,YAAYH,eAGjCI,iBAAiBX,SAAQC,eACdC,OAAQC,UAAYF,OAAOG,OAAOL,MAAM,KACzCM,MAAQF,SAASG,KAAK,KACtBC,cAAgB5B,SAAS6B,cAAc,UAC7CD,cAAcrB,MAAQgB,IACtBK,cAAcE,YAAcJ,MAC5BvB,iBAAiB4B,YAAYH,0BAIlCV,QAEVe,OAAM,WACG,IAAIjB,MAAM"}