{"version":3,"file":"pdfembed.min.js","sources":["../src/pdfembed.js"],"sourcesContent":["// This file is part of the mod_coursecertificate plugin for Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * This module provides functionality for embedding PDFs using pdf.js.\n *\n * @module      mod_datalynx/pdfembed\n * @copyright   2023 David Bogner <david.bogner@wunderbyte.at>\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n// import * as pdfjsLib from 'mod_datalynx/pdf';\n// import * as pdfjsWorker from 'mod_datalynx/pdf.worker';\n\n/**\n * Renders a PDF document onto a canvas element.\n * @param {string} url - The URL of the PDF document to render.\n * @param {HTMLElement} canvasContainer - The container element where the canvas will be appended.\n * @param {number} customScale - The custom scale for rendering the PDF.\n */\nfunction renderPDFfunction(url, canvasContainer, customScale) {\n\n    /**\n     * Renders a single page of the PDF document onto a canvas element.\n     * @param {Object} page - The PDF page object to render.\n     */\n    function renderPage(page) {\n        var viewport = page.getViewport({ scale: 1 });\n        var canvas = document.createElement('canvas');\n        var ctx = canvas.getContext('2d');\n\n        var desiredWidth = 595;\n        var desiredHeight = 841;\n\n        canvas.width = Math.floor(viewport.width * customScale);\n        canvas.height = Math.floor(viewport.height * customScale);\n        canvas.style.width = Math.floor(viewport.width) + \"px\";\n        canvas.style.height = Math.floor(viewport.height) + \"px\";\n\n        var transform = customScale !== 1\n            ? [customScale, 0, 0, customScale, 0, 0]\n            : null;\n\n        var renderContext = {\n            canvasContext: ctx,\n            transform: transform,\n            viewport: viewport\n        };\n        canvas.height = desiredHeight * customScale;\n        canvas.width = desiredWidth * customScale;\n        canvas.style = \"width: \" + (desiredWidth * customScale) + \"px; height: \" + (desiredHeight * customScale) + \"px;\";\n\n        canvasContainer.appendChild(canvas);\n\n        // eslint-disable-next-line no-console\n        console.log(canvasContainer, canvas, canvas.height);\n\n        page.render(renderContext);\n    }\n\n    /**\n     * Renders all pages of the PDF document.\n     * @param {Object} pdfDoc - The PDF document object.\n     */\n    function renderPages(pdfDoc) {\n        for (var num = 1; num <= pdfDoc.numPages; num++) {\n            // eslint-disable-next-line promise/catch-or-return\n            pdfDoc.getPage(num).then(renderPage);\n        }\n    }\n\n    // eslint-disable-next-line no-undef\n    pdfjsLib.GlobalWorkerOptions.workerSrc = pdfjsWorker;\n\n    // eslint-disable-next-line no-console, no-undef\n    console.log(pdfjsLib.version, pdfjsWorker);\n\n    // eslint-disable-next-line promise/catch-or-return, no-undef\n    pdfjsLib.getDocument(url).promise.then(renderPages);\n}\n\n/**\n * Renders a PDF document onto a specified container.\n * @param {string} pdfUrl - The URL of the PDF document to render.\n * @param {string} canvasContainerId - The ID of the container element where the canvas will be appended.\n * @param {number} customScale - The custom scale for rendering the PDF.\n */\nexport function renderPDF(pdfUrl, canvasContainerId, customScale) {\n    /* eslint-disable no-console */\n    console.log(pdfUrl, canvasContainerId, customScale);\n\n    const container = document.querySelector(`#${canvasContainerId}`);\n\n    // eslint-disable-next-line no-undef\n    console.log(pdfjsLib);\n    console.log(pdfUrl);\n    console.log(container);\n    /* eslint-enable no-console */\n    renderPDFfunction(pdfUrl, container, customScale);\n}\n"],"names":["pdfUrl","canvasContainerId","customScale","console","log","container","document","querySelector","pdfjsLib","url","canvasContainer","renderPage","page","viewport","getViewport","scale","canvas","createElement","ctx","getContext","desiredWidth","desiredHeight","width","Math","floor","height","style","renderContext","canvasContext","transform","appendChild","render","renderPages","pdfDoc","num","numPages","getPage","then","GlobalWorkerOptions","workerSrc","pdfjsWorker","version","getDocument","promise","renderPDFfunction"],"mappings":"mJAmG0BA,OAAQC,kBAAmBC,aAEjDC,QAAQC,IAAIJ,OAAQC,kBAAmBC,mBAEjCG,UAAYC,SAASC,yBAAkBN,oBAG7CE,QAAQC,IAAII,UACZL,QAAQC,IAAIJ,QACZG,QAAQC,IAAIC;;;;;;;;SA5EWI,IAAKC,gBAAiBR,sBAMpCS,WAAWC,UACZC,SAAWD,KAAKE,YAAY,CAAEC,MAAO,IACrCC,OAASV,SAASW,cAAc,UAChCC,IAAMF,OAAOG,WAAW,MAExBC,aAAe,IACfC,cAAgB,IAEpBL,OAAOM,MAAQC,KAAKC,MAAMX,SAASS,MAAQpB,aAC3Cc,OAAOS,OAASF,KAAKC,MAAMX,SAASY,OAASvB,aAC7Cc,OAAOU,MAAMJ,MAAQC,KAAKC,MAAMX,SAASS,OAAS,KAClDN,OAAOU,MAAMD,OAASF,KAAKC,MAAMX,SAASY,QAAU,SAMhDE,cAAgB,CAChBC,cAAeV,IACfW,UAN4B,IAAhB3B,YACV,CAACA,YAAa,EAAG,EAAGA,YAAa,EAAG,GACpC,KAKFW,SAAUA,UAEdG,OAAOS,OAASJ,cAAgBnB,YAChCc,OAAOM,MAAQF,aAAelB,YAC9Bc,OAAOU,MAAQ,UAAaN,aAAelB,YAAe,eAAkBmB,cAAgBnB,YAAe,MAE3GQ,gBAAgBoB,YAAYd,QAG5Bb,QAAQC,IAAIM,gBAAiBM,OAAQA,OAAOS,QAE5Cb,KAAKmB,OAAOJ,wBAOPK,YAAYC,YACZ,IAAIC,IAAM,EAAGA,KAAOD,OAAOE,SAAUD,MAEtCD,OAAOG,QAAQF,KAAKG,KAAK1B,YAKjCH,SAAS8B,oBAAoBC,UAAYC,YAGzCrC,QAAQC,IAAII,SAASiC,QAASD,aAG9BhC,SAASkC,YAAYjC,KAAKkC,QAAQN,KAAKL,aAoBvCY,CAAkB5C,OAAQK,UAAWH"}