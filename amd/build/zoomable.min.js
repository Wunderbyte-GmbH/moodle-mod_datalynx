/**
 * @module mod_datalynx/zoomable
 * @copyright 2017 Thomas Niedermaier (thomas.niedermaier@gmail.com)
 * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("mod_datalynx/zoomable",["jquery"],(function($){var instance=new function(){};return instance.init=function(){$.tools=$.tools||{version:"@VERSION"},$.tools.overlay={addEffect:function(name,loadFn,closeFn){effects[name]=[loadFn,closeFn]},conf:{close:null,closeOnClick:!0,closeOnEsc:!0,closeSpeed:"fast",effect:"default",fixed:!/msie/.test(navigator.userAgent.toLowerCase())||navigator.appVersion>6,left:"center",load:!1,mask:null,oneInstance:!0,speed:"normal",target:null,top:"10%"}};var instances=[],effects={};function Overlay(trigger,conf){var closers,overlay,opened,self=this,fire=trigger.add(self),w=$(window),maskConf=$.tools.expose&&(conf.mask||conf.expose),uid=Math.random().toString().slice(10);maskConf&&("string"==typeof maskConf&&(maskConf={color:maskConf}),maskConf.closeOnClick=maskConf.closeOnEsc=!1);var jq=conf.target||trigger.attr("rel");if(!(overlay=jq?$(jq):trigger).length)throw"Could not find Overlay: "+jq;trigger&&-1==trigger.index(overlay)&&trigger.click((function(e){return self.load(e),e.preventDefault()})),$.extend(self,{load:function(e){if(self.isOpened())return self;var eff=effects[conf.effect];if(!eff)throw'Overlay: cannot find effect : "'+conf.effect+'"';if(conf.oneInstance&&$.each(instances,(function(){this.close(e)})),(e=e||$.Event()).type="onBeforeLoad",fire.trigger(e),e.isDefaultPrevented())return self;opened=!0,maskConf&&$(overlay).expose(maskConf);var top=conf.top,left=conf.left,oWidth=overlay.outerWidth(!0),oHeight=overlay.outerHeight(!0);return"string"==typeof top&&(top="center"==top?Math.max((w.height()-oHeight)/2,0):parseInt(top,10)/100*w.height()),"center"==left&&(left=Math.max((w.width()-oWidth)/2,0)),eff[0].call(self,{top:top,left:left},(function(){opened&&(e.type="onLoad",fire.trigger(e))})),maskConf&&conf.closeOnClick&&$.mask.getMask().one("click",self.close),conf.closeOnClick&&$(document).on("click."+uid,(function(e){$(e.target).parents(overlay).length||self.close(e)})),conf.closeOnEsc&&$(document).on("keydown."+uid,(function(e){27==e.keyCode&&self.close(e)})),self},close:function(e){return self.isOpened()?((e=e||$.Event()).type="onBeforeClose",fire.trigger(e),e.isDefaultPrevented()?void 0:(opened=!1,effects[conf.effect][1].call(self,(function(){e.type="onClose",fire.trigger(e)})),$(document).off("click."+uid+" keydown."+uid),maskConf&&$.mask.close(),self)):self},getOverlay:function(){return overlay},getTrigger:function(){return trigger},getClosers:function(){return closers},isOpened:function(){return opened},getConf:function(){return conf}}),$.each("onBeforeLoad,onStart,onLoad,onBeforeClose,onClose".split(","),(function(i,name){$.isFunction(conf[name])&&$(self).on(name,conf[name]),self[name]=function(fn){return fn&&$(self).on(name,fn),self}})),(closers=overlay.find(conf.close||".close")).length||conf.close||(closers=$('<a class="close"></a>'),overlay.prepend(closers)),closers.click((function(e){self.close(e)})),conf.load&&self.load()}$.tools.overlay.addEffect("default",(function(pos,onLoad){var conf=this.getConf(),w=$(window);conf.fixed||(pos.top+=w.scrollTop(),pos.left+=w.scrollLeft()),pos.position=conf.fixed?"fixed":"absolute",this.getOverlay().css(pos).fadeIn(conf.speed,onLoad)}),(function(onClose){this.getOverlay().fadeOut(this.getConf().closeSpeed,onClose)})),$.fn.overlay=function(conf){var el=this.data("overlay");return el||($.isFunction(conf)&&(conf={onBeforeLoad:conf}),conf=$.extend(!0,{},$.tools.overlay.conf,conf),this.each((function(){el=new Overlay($(this),conf),instances.push(el),$(this).data("overlay",el)})),conf.api?el:this)};var divname="",index=0;$((function(){function writenewoverlay(trigger){divname="zoomable"+index,index+=1,$("<img/>").attr("src",trigger.attr("src")).on("load",(function(){var height=this.height,width=this.width;if(height>$(window).height()-60){var heightbefore=height;height=$(window).height()-60,width=Math.round(height*width/heightbefore)}if(width>$(window).width()-60){var widthbefore=width;width=$(window).width()-60,height=Math.round(width*height/widthbefore)}$("body").append('<div id="'+divname+'" class="m3e-overlay"><div class="close m3e-closebutton"></div><img src="'+trigger.attr("src")+'" width="'+width+'" height="'+height+'" class="close" /></div>'),trigger.attr("rel","#"+divname),trigger.overlay({load:!0,top:"center"})}))}$("img.zoomable").attr("title","Zum Vergrößern klicken"),$(document).on("click","img.zoomable",(function(){var $this=$(this);$this.attr("rel")&&($this.removeData("overlay"),$($this.attr("rel")).remove(),$this.removeAttr("rel")),writenewoverlay($this)})),$(window).resize((function(){$("[rel]").each((function(){var $this=$(this),api=$this.data("overlay");null!=api&&api.isOpened()&&($this.removeData("overlay"),$($this.attr("rel")).remove(),$this.removeAttr("rel"),writenewoverlay($this))}))}))}))},instance}));

//# sourceMappingURL=zoomable.min.js.map