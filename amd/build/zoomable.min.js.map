{"version":3,"file":"zoomable.min.js","sources":["../src/zoomable.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/.\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle. If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * @module mod_datalynx/zoomable\n * @copyright 2017 Thomas Niedermaier (thomas.niedermaier@gmail.com)\n * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n/**\n * Create new dayslots as duplicates of the seven original day slots\n */\n\n\ndefine(\n    ['jquery'], function($) {\n\n        /**\n         * @constructor\n         * @alias module:mod_datalynx/zoomable\n         */\n        var Zoomable = function(){};\n\n        var instance = new Zoomable();\n\n        instance.init = function() {\n\n        $.tools = $.tools || {\n            version: '@VERSION'\n        };\n        $.tools.overlay = {\n            addEffect: function(name, loadFn, closeFn) {\n                effects[name] = [loadFn, closeFn];\n            },\n            conf: {\n                close: null,\n                closeOnClick: true,\n                closeOnEsc: true,\n                closeSpeed: 'fast',\n                effect: 'default',\n                fixed: !/msie/.test(navigator.userAgent.toLowerCase()) || navigator.appVersion > 6,\n                left: 'center',\n                load: false,\n                mask: null,\n                oneInstance: true,\n                speed: 'normal',\n                target: null,\n                top: '10%'\n            }\n        };\n        var instances = [],\n            effects = {};\n        $.tools.overlay.addEffect('default', function(pos, onLoad) {\n            var conf = this.getConf(),\n                w = $(window);\n            if (!conf.fixed) {\n                pos.top += w.scrollTop();\n                pos.left += w.scrollLeft();\n            }\n            pos.position = conf.fixed ? 'fixed' : 'absolute';\n            this.getOverlay().css(pos).fadeIn(conf.speed, onLoad);\n        }, function(onClose) {\n            this.getOverlay().fadeOut(this.getConf().closeSpeed, onClose);\n        });\n\n            /**\n             * The overlay function.\n             * @param {HTMLElement} trigger\n             * @param {function} conf\n             * @constructor\n             */\n        function Overlay(trigger, conf) {\n            var self = this,\n                fire = trigger.add(self),\n                w = $(window),\n                closers, overlay, opened, maskConf = $.tools.expose && (conf.mask || conf.expose),\n                uid = Math.random().toString().slice(10);\n            if (maskConf) {\n                if (typeof maskConf == 'string') {\n                    maskConf = {\n                        color: maskConf\n                    };\n                }\n                maskConf.closeOnClick = maskConf.closeOnEsc = false;\n            }\n            var jq = conf.target || trigger.attr(\"rel\");\n            overlay = jq ? $(jq) : null || trigger;\n            if (!overlay.length) {\n                throw \"Could not find Overlay: \" + jq;\n            }\n            if (trigger && trigger.index(overlay) == -1) {\n                trigger.click(function(e) {\n                    self.load(e);\n                    return e.preventDefault();\n                });\n            }\n            $.extend(self, {\n                load: function(e) {\n                    if (self.isOpened()) {\n                        return self;\n                    }\n                    var eff = effects[conf.effect];\n                    if (!eff) {\n                        throw \"Overlay: cannot find effect : \\\"\" + conf.effect + \"\\\"\";\n                    }\n                    if (conf.oneInstance) {\n                        $.each(instances, function() {\n                            this.close(e);\n                        });\n                    }\n                    e = e || $.Event();\n                    e.type = \"onBeforeLoad\";\n                    fire.trigger(e);\n                    if (e.isDefaultPrevented()) {\n                        return self;\n                    }\n                    opened = true;\n                    if (maskConf) {\n                        $(overlay).expose(maskConf);\n                    }\n                    var top = conf.top,\n                        left = conf.left,\n                        oWidth = overlay.outerWidth(true),\n                        oHeight = overlay.outerHeight(true);\n                    if (typeof top == 'string') {\n                        top = top == 'center' ? Math.max((w.height() - oHeight) / 2, 0) : parseInt(top, 10) / 100 * w.height();\n                    }\n                    if (left == 'center') {\n                        left = Math.max((w.width() - oWidth) / 2, 0);\n                    }\n                    eff[0].call(self, {\n                        top: top,\n                        left: left\n                    }, function() {\n                        if (opened) {\n                            e.type = \"onLoad\";\n                            fire.trigger(e);\n                        }\n                    });\n                    if (maskConf && conf.closeOnClick) {\n                        $.mask.getMask().one(\"click\", self.close);\n                    }\n                    if (conf.closeOnClick) {\n                        $(document).on(\"click.\" + uid, function(e) {\n                            if (!$(e.target).parents(overlay).length) {\n                                self.close(e);\n                            }\n                        });\n                    }\n                    if (conf.closeOnEsc) {\n                        $(document).on(\"keydown.\" + uid, function(e) {\n                            if (e.keyCode == 27) {\n                                self.close(e);\n                            }\n                        });\n                    }\n                    return self;\n                },\n                close: function(e) {\n                    if (!self.isOpened()) {\n                        return self;\n                    }\n                    e = e || $.Event();\n                    e.type = \"onBeforeClose\";\n                    fire.trigger(e);\n                    if (e.isDefaultPrevented()) {\n                        return;\n                    }\n                    opened = false;\n                    effects[conf.effect][1].call(self, function() {\n                        e.type = \"onClose\";\n                        fire.trigger(e);\n                    });\n                    $(document).off(\"click.\" + uid + \" keydown.\" + uid);\n                    if (maskConf) {\n                        $.mask.close();\n                    }\n                    return self;\n                },\n                getOverlay: function() {\n                    return overlay;\n                },\n                getTrigger: function() {\n                    return trigger;\n                },\n                getClosers: function() {\n                    return closers;\n                },\n                isOpened: function() {\n                    return opened;\n                },\n                getConf: function() {\n                    return conf;\n                }\n            });\n            $.each(\"onBeforeLoad,onStart,onLoad,onBeforeClose,onClose\".split(\",\"), function(i, name) {\n                if ($.isFunction(conf[name])) {\n                    $(self).on(name, conf[name]);\n                }\n                self[name] = function(fn) {\n                    if (fn) {\n                        $(self).on(name, fn);\n                    }\n                    return self;\n                };\n            });\n            closers = overlay.find(conf.close || \".close\");\n            if (!closers.length && !conf.close) {\n                closers = $('<a class=\"close\"></a>');\n                overlay.prepend(closers);\n            }\n            closers.click(function(e) {\n                self.close(e);\n            });\n            if (conf.load) {\n                self.load();\n            }\n        }\n        $.fn.overlay = function(conf) {\n            var el = this.data(\"overlay\");\n            if (el) {\n                return el;\n            }\n            if ($.isFunction(conf)) {\n                conf = {\n                    onBeforeLoad: conf\n                };\n            }\n            conf = $.extend(true, {}, $.tools.overlay.conf, conf);\n            this.each(function() {\n                el = new Overlay($(this), conf);\n                instances.push(el);\n                $(this).data(\"overlay\", el);\n            });\n            return conf.api ? el : this;\n        };\n\n        var divname = \"\",\n            index = 0;\n        $(function() {\n            $('img.zoomable').attr('title', \"Zum Vergrößern klicken\");\n            $(document).on('click', 'img.zoomable', function() {\n                var $this = $(this);\n                if ($this.attr('rel')) {\n                    $this.removeData(\"overlay\");\n                    $($this.attr('rel')).remove();\n                    $this.removeAttr(\"rel\");\n                }\n                writenewoverlay($this);\n            });\n            $(window).resize(function() {\n                $(\"[rel]\").each(function() {\n                    var $this = $(this),\n                        api = $this.data(\"overlay\");\n                    if (api != undefined) {\n                        if (api.isOpened()) {\n                            $this.removeData(\"overlay\");\n                            $($this.attr('rel')).remove();\n                            $this.removeAttr(\"rel\");\n                            writenewoverlay($this);\n                        }\n                    }\n                });\n            });\n\n            /**\n             * Write the overlay.\n             * @param {HTMLElement} trigger\n             */\n            function writenewoverlay(trigger) {\n                divname = 'zoomable' + index;\n                index = index + 1;\n                $(\"<img/>\").attr(\"src\", trigger.attr(\"src\")).on('load', function() {\n                    var height = this.height,\n                        width = this.width;\n                    if (height > $(window).height() - 60) {\n                        var heightbefore = height;\n                        height = $(window).height() - 60;\n                        width = Math.round(height * width / heightbefore);\n                    }\n                    if (width > $(window).width() - 60) {\n                        var widthbefore = width;\n                        width = $(window).width() - 60;\n                        height = Math.round(width * height / widthbefore);\n                    }\n                    $('body').append('<div id=\"' + divname +\n                        '\" class=\"m3e-overlay\"><div class=\"close m3e-closebutton\"></div><img src=\"' +\n                        trigger.attr('src') + '\" width=\"' + width + '\" height=\"' + height + '\" class=\"close\" /></div>');\n                    trigger.attr('rel', '#' + divname);\n                    trigger.overlay({\n                        load: true,\n                        top: \"center\"\n                    });\n                });\n            }\n        });\n    };\n\n    return instance;\n\n    }\n);\n\n"],"names":["define","$","instance","init","tools","version","overlay","addEffect","name","loadFn","closeFn","effects","conf","close","closeOnClick","closeOnEsc","closeSpeed","effect","fixed","test","navigator","userAgent","toLowerCase","appVersion","left","load","mask","oneInstance","speed","target","top","instances","Overlay","trigger","closers","opened","self","this","fire","add","w","window","maskConf","expose","uid","Math","random","toString","slice","color","jq","attr","length","index","click","e","preventDefault","extend","isOpened","eff","each","Event","type","isDefaultPrevented","oWidth","outerWidth","oHeight","outerHeight","max","height","parseInt","width","call","getMask","one","document","on","parents","keyCode","off","getOverlay","getTrigger","getClosers","getConf","split","i","isFunction","fn","find","prepend","pos","onLoad","scrollTop","scrollLeft","position","css","fadeIn","onClose","fadeOut","el","data","onBeforeLoad","push","api","divname","writenewoverlay","heightbefore","round","widthbefore","append","$this","removeData","remove","removeAttr","resize","undefined"],"mappings":"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"}